@model GoldenLadle.Models.Event

@{
    ViewData["Title"] = "Details";
}
<input type="hidden" id="eventId" value="@Model.Id" />
<input type="hidden" id="loggedInUser" value="@ViewBag.LoggedInUser" />
</div>
<div id="event" style="background: url('/images/@Model.FilePaths.First(f => f.FileType == FileType.Header).FileName') center center no-repeat;">
    <div class="container event-header">
        <div class="col-sm-12">
            <h1 class="text-center text-white shadow">@Html.DisplayFor(model => model.Name)</h1>
        </div>
        <div class="row">
            <div class="col-sm-12 col-md-3"></div>
            <div class="col-sm-12 col-md-3">
                <h4 class="text-center text-white shadow">Start Date:</h4>
                <p class="text-center text-white shadow">@Html.DisplayFor(model => model.EndDT)</p>
            </div>
            <div class="col-sm-12 col-md-3">
                <h4 class="text-center text-white shadow">End Date:</h4>
                <p class="text-center text-white shadow">@Html.DisplayFor(model => model.EndDT)</p>
            </div>
            <div class="col-sm-12 col-md-3"></div>
        </div>

        @if (Model.EndDT <= DateTime.Now)
        {
            <div class="row">
                <div class="col-sm-12 col">
                    @foreach (Entry entry in Model.Entries.OrderByDescending(en => en.Value).Take(3))
                    {
                        <h4 class="text-center text-light shadow"><em>1st Place:</em> @entry.Name]</h4>
                    }
                </div>
            </div>
        }
        else if (Model.Entries.Any())
        {
            <div class="row justify-content-center">
                <div class="col-sm-12 col-md-3">
                    @Html.ActionLink("Enter The Contest", "Create", "Entries", new { eventId = Model.Id }, new { @class = "btn btn-lg btn-block btn-success" })
                </div>
            </div>
            <br />
            <div class="row">

                @foreach (Entry entry in Model.Entries)
                {
                    <div class="col-sm-3">
                        <div class="card text-center" style="margin-bottom:20px;">
                            <div class="card-body">
                                <h5 class="card-title">@entry.Name</h5>
                                <p class="card-text">@entry.Description</p>
                                @if (this.User.IsInRole("Admin") || this.User.IsInRole("NormalUser"))
                                {
                                    @for (int i = 1; i < 4; i++)
                                    {
                                        @if (entry.Votes.Any(v => v.Value == i && v.UserId == ViewBag.LoggedInUser))
                                        {
                                            <p class="vote@(i)-tooltip" data-toggle="tooltip" data-html="true" data-placement="top" title="<strong>Voted #@(i)</strong> Click to undo." tabindex="0">
                                                <button class="btn btn-block btn-success  vote@(i) disabled" id="vote@(i)_@entry.Id" value="@(i)" data-voteid="@entry.Votes.FirstOrDefault(v => v.Value == i && v.UserId == ViewBag.LoggedInUser).Id"><i class="fas fa-thumbs-up text-left"></i> Vote #@(i)</button>
                                            </p>
                                        }
                                        else if (Model.Entries.Any(e => e.Votes.Any(v => v.UserId == ViewBag.LoggedInUser && v.Value == i)))
                                        {

                                            <p class="vote@(i)-tooltip" data-toggle="tooltip" data-html="true" data-placement="top" title="You Can't Vote for #@(i) more than once." tabindex="0">
                                                <button class="btn btn-block btn-outline-success  vote@(i) disabled" id="vote@(i)_@entry.Id" value="@(i)"><i class="fas fa-thumbs-up text-left"></i> Vote #@(i)</button>
                                            </p>
                                        }
                                        else
                                        {
                                            <p class="vote@(i)-tooltip" tabindex="0">
                                                <button class="btn btn-block btn-outline-success vote@(i)" id="vote@(i)_@entry.Id" value="@(i)"><i class="fas fa-thumbs-up text-left"></i> Vote #@(i)</button>
                                            </p>
                                        }
                                    }
                                }
                                else
                                {
                                    <a asp-controller="Account" asp-action="Login" class="btn btn-danger"><i class="far fa-frown"></i> Sign In To Vote</a>
                                }
                                <br />
                                @if (this.User.IsInRole("Admin"))
                                {
                                    <p style="margin-top:.5rem;"><em>Points: <strong>@entry.Value</strong></em></p>
                                }
                                @if (entry.UserId == ViewBag.LoggedInUser)
                                {
                                    <a href="/Entries/Edit/@entry.Id" class="btn btn-primary btn-block">Edit</a>
                                    <a href="/Entries/Delete/@entry.Id" class="btn btn-danger btn-block">Delete</a>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="row justify-content-center">
                <div class="col-sm-12 col-md-3">
                    @Html.ActionLink("Enter The Contest", "Create", "Entries", new { eventId = Model.Id }, new { @class = "btn btn-lg btn-block btn-success" })
                </div>
            </div>
            <div class="row justify-content-center" style="padding-top:3rem;">
                <div class="col-sm-12 col-md-5">
                    <h3 class="text-center text-white shadow">Hello? Is there anybody out there?<br />No on has entered the contest yet!</h3>
                </div>
            </div>
        }


        @if (this.User.IsInRole("Admin"))
        {
            <div class="d-flex justify-content-end">
                <div class="p-2">
                    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary">Edit</a>
                </div>
                <div class="p-2">
                    <a asp-action="Index" class="btn btn-dark">Back to List</a>
                </div>
            </div>
        }
    </div>

    <h2 id="loader-wrapper">
        <div id="loader"></div>

        <div class="loader-section section-left"></div>
        <div class="loader-section section-right"></div>

</div>
@section Stylesheets{
    <link rel="stylesheet" href="~/css/loader.css" />
}
@section Scripts{
    <script src="https://unpkg.com/tippy.js@2.3.0/dist/tippy.all.min.js"></script>
    <script src="~/js/voting.js" type="text/javascript"></script>
}
